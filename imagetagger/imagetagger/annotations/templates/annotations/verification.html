{% extends 'base/base.html' %}
{% load static %}
{% block taggerimports %}
<script type="text/javascript" src="{% static 'scripts/verify_scripts.js' %}"></script>
{% endblock %}
{% block individual_script %}
    function init_navigationbuttons() {
        {% if next_annotation %}
        $('#next_button').click(function(){
            $('#verification_form').attr('action', '{% url 'annotations:verify' next_annotation.id %}{% if filtered is not None %}?selected_annotation_type={{ filtered }}{% endif %}');
            $('#verification_form').submit();
        });
        {% else %}
        $('#next_button').attr('disabled', 'true');
        $('#next_unverified_button').attr('disabled', 'true');
        {% endif %}

        {% if last_annotation %}
        $('#last_button').click(function(){
            $('#verification_form').attr('action', '{% url 'annotations:verify' last_annotation.id %}{% if filtered is not None %}?selected_annotation_type={{ filtered }}{% endif %}');
            $('#verification_form').submit();
        });
        {% else %}
        $('#last_button').attr('disabled', 'true');
        $('#last_unverified_button').attr('disabled', 'true');
        {% endif %}

        {% if next_unverified_annotation %}
        $('#next_unverified_button').click(function(){
            $('#verification_form').attr('action', '{% url 'annotations:verify' next_unverified_annotation.id %}{% if filtered is not None %}?selected_annotation_type={{ filtered }}{% endif %}');
            $('#verification_form').submit();
        });
        $('#accept_button').click(function(){
          $('#state').attr('value', 'accept');
          $('#verification_form').attr('action', '{% url 'annotations:verify' next_unverified_annotation.id %}');
          $('#verification_form').submit();
        });

        $('#reject_button').click(function(){
          $('#state').attr('value', 'reject');
          $('#verification_form').attr('action', '{% url 'annotations:verify' next_unverified_annotation.id %}');
          $('#verification_form').submit();
        });

        {% else %}
        $('#next_unverified_button').attr('disabled', 'true');
        $('#accept_button').click(function(){
          $('#state').attr('value', 'accept');
          $('#verification_form').attr('action', '{% url 'annotations:verify' first_annotation.id %}');
          $('#verification_form').submit();
        });

        $('#reject_button').click(function(){
          $('#state').attr('value', 'reject');
          $('#verification_form').attr('action', '{% url 'annotations:verify' first_annotation.id %}');
          $('#verification_form').submit();
        });
        {% endif %}

        {% if last_unverified_annotation %}
        $('#last_unverified_button').click(function(){
            $('#verification_form').attr('action', '{% url 'annotations:verify' last_unverified_annotation.id %}{% if filtered is not None %}?selected_annotation_type={{ filtered }}{% endif %}');
            $('#verification_form').submit();
        });
        {% else %}
        $('#last_unverified_button').attr('disabled', 'true');
        {% endif %}
        $('#edit_button').click(function(){window.location.href='{% url 'annotations:edit_annotation' annotation.id %}'});
    }



{% endblock %}
{% block bodyblock %}
<div class="container-fluid">
    <div class="row">
        <div class="col-md-3">
            <form id="annotation_form" action="{{request.get_full_path}}" enctype="multipart/form-data" method="get">

                        <input type="hidden" name="annotation_id" value="{{ annotation.id }}">
                        annotation type:
                        {% include "annotations/annotationtypes.html" %}

                        <input name="filter" type="submit" value="filter">


                {% if filtered is not None %}
                    <a href="{{request.path}}" target="_self"> [x] </a>
                {% endif %}
            </form>
            <div class="panel panel-default">
                <div class="panel-heading">
                    <a href="{% url 'annotations:manage_annotations' image.image_set.id %}">
                        <u><h3 class="panel-title">{{image.image_set.name}}</h3></u></a>
                </div>
                <div class="panel-body">
                    {% for set_annotation in set_annotations %}
                        {% if set_annotation.id == annotation.id %}
                            {{ set_annotation.image.name }}: <b id="selected_annotation_row">{{annotation.content}}</b><br>
                        {% else %}
                            {{ set_annotation.image.name }}:
                                <a href="{% url 'annotations:verify' set_annotation.id %}">{{set_annotation.content}}</a><br>
                        {% endif %}
                    {% endfor %}
                </div>
            </div>
        </div>
        <div class="col-md-6">
            <div class="wrapper">
                <img id="picture" src="{% url 'images:view_image' image.id %}" alt="Picture {{image.name}} not found!" width="100%" data-x="{{ annotation_x }}" data-y="{{ annotation_y }}" data-width="{{ width }}" data-height="{{ height }}"></br>
                <div id="boundingBox"></div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="panel panel-default">
                <div class="panel-body">
                    <form id='verification_form' enctype="multipart/form-data" method="post" action="{% url 'annotations:verify' annotation.id %}{% if filtered is not None %}?selected_annotation_type={{ filtered }}{% endif %}">
                        {% csrf_token %}
                        <input type='hidden' id='state' name='state' value='blank'>
                        <input type='hidden' id='annotation' name='annotation' value='{{ annotation.id }}'>
                        <h4>{{ annotation_type }}</h4>
                        <button class="btn btn-success" type='button' id='accept_button'>
                            <span class="glyphicon glyphicon-ok" aria-hidden="true"></span> YAY (j)</button>
                        <button class="btn btn-danger" type='button' id='reject_button'>
                            <span class="glyphicon glyphicon-remove" aria-hidden="true"></span> NAY (k)</button>
                        <button class="btn btn-warning" type='button' id='edit_button'>
                            <span class="glyphicon glyphicon-pencil" aria-hidden="true"></span> Edit (e)</button><br>
                        <button class="btn btn-default" type='button' id='last_unverified_button'>
                            <span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span> Last unverified (a)</button>
                        <button class="btn btn-default" type='button' id='last_button'>
                            <span class="glyphicon glyphicon-menu-left" aria-hidden="true"></span> Last (s)</button><br>
                        <button class="btn btn-default" type='button' id='next_button'>
                            <span class="glyphicon glyphicon-menu-right" aria-hidden="true"></span> Next (d)</button>
                        <button class="btn btn-default" type='button' id='next_unverified_button'>
                            <span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span> Next unverified (f)</button>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
